name: builder qbee_image

on:
  workflow_dispatch:
jobs:
  docker:
    runs-on: ubuntu-latest
    steps:
      -
        name: Checkout
        uses: actions/checkout@v4
        #with:
          #submodules: true
      - 
        name: Checkout qbee
        uses: actions/checkout@v4 
        with:
          repository: DDS-Derek/qBittorrent-Enhanced-Edition-Docker
          path: QBEE
      #-        
        #name: Set up QEMU
        #uses: docker/setup-qemu-action@v2
      #-
        #name: Set up Docker Buildx
        #uses: docker/setup-buildx-action@v2
      #- 
        #name: Cache Docker layers
        #uses: actions/cache@v3
        #with:
          #path: /tmp/.buildx-cache
          #key: ${{ runner.os }}-buildx-${{ github.sha }}
          #restore-keys: |
           #${{ runner.os }}-buildx-
      - 
        name: Copy files
        env:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
          Github_Token: ${{ secrets.GITHUB_TOKEN }}
        run: | 
          sudo mkdir -p /etc/DDSRem &&
          cd /home/runner/work/vps/vps/build_image/qbee
          jq ".Github_Token = \"$Github_Token\" | .Dockerhub_Username = \"$username\" | .Dockerhub_Password = \"$password\"" config.json > 1.json &&
          mv 1.json  config.json &&
          sudo cp -rf config.json  /etc/DDSRem/config.json &&
          cd /etc/DDSRem &&
          echo "$(ls /etc/DDSRem/)" &&
          echo "$(jq -r '.Dockerhub_Username' /etc/DDSRem/config.json)"
          echo "$(jq -r '.Dockerhub_Password' /etc/DDSRem/config.json)"
          echo "$(jq -r '.Github_Token' /etc/DDSRem/config.json)"
          echo "当前路径: $(pwd)"
      - 
        name: Execute SH
        env:
          command1: docker login --password ${Dockerhub_Password} --username ${Dockerhub_Username}
          command2: ${Dockerhub_Password} | docker login ${Dockerhub_Username} --password-stdin
        run:  |
          cd /home/runner/work/vps/vps/QBEE
          jq '.ARCH = "linux/amd64"' Build.json > 1.json &&
          mv 1.json  Build.json &&
          echo "当前路径: $(pwd)"  &&
          echo "当前路径: ${HOME}"  &&
          echo "$(ls /etc/DDSRem/)" &&
          echo "$(jq -r '.Dockerhub_Username' /etc/DDSRem/config.json)"
          echo "$(jq -r '.Dockerhub_Password' /etc/DDSRem/config.json)"
          echo "$(jq -r '.ARCH' ./Build.json)"
          sed -i 's/-it//g' Build.sh
          sed -i 's/$command1/$command2/g' Build.sh
          echo "$(cat -n Build.sh)"
          chmod +x ./Build.sh  &&
        #./Build.sh
      #-
        #name: Login to Docker Hub
        #uses: docker/login-action@v2
        #with:
          #username: ${{ secrets.DOCKERHUB_USERNAME }}
          #password: ${{ secrets.DOCKERHUB_TOKEN }}
      #- 
        #name: Lower case dockerhub image name
        #id: dockerhub_image
        #uses: ASzc/change-string-case-action@v5
        #with:
          #string: ${{ secrets.DOCKERHUB_USERNAME }}/${{ secrets.PACKAGE_C }}
      #- 
        #name: Get qbee version
        #id: qbee_version
        #uses: pozetroninc/github-action-get-latest-release@master
        #with:
          #repository: c0re100/qBittorrent-Enhanced-Edition
      #- 
        #run: echo "最新版本为 ${{ steps.qbee_version.outputs.release  }}"
      #-
        #name: Build and push with qbee
        #uses: docker/build-push-action@v4
        #with:
          #context: QBEE
          #file: ./QBEE/Dockerfile
          #platforms: linux/amd64
          #push: true
          #tags: |
            #${{ secrets.DOCKERHUB_USERNAME }}/qbittorrentee:${{ steps.qbee_version.outputs.release  }}
            #${{ secrets.DOCKERHUB_USERNAME }}/qbittorrentee
          #cache-from: type=local,src=/tmp/.buildx-cache
          #cache-to: type=local,dest=/tmp/.buildx-cache-new,mode=max
     # - 
        #name: Move cache
        #run: |
          #rm -rf /tmp/.buildx-cache
         #mv /tmp/.buildx-cache-new /tmp/.buildx-cache

